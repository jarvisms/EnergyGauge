<!DOCTYPE html>
<html>
<head>
<style>
@font-face {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 400;
  src: local('Lato Regular'), local('Lato-Regular'), url('Lato.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
* {
  margin: 0;
  padding: 0;
  border: 0;
}

body,
html {
  width: 100%;
  height: 100%;
  margin: 0px auto;
  background-image: url('Background.jpg');
  font-family: Verdana, Geneva, sans-serif;
  font-size: 12px;
  color: #ccc;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  //overflow: hidden;
}
svg {
  border: 1px solid black;
}
</style>
</head>
<body>
<div id="Gauge1" style="width:75%"></div>

<script>
function extend(obj, more) {
  Object.keys(more).forEach(function(key) { obj[key] = more[key]; });
  return obj;
}
function setAttributes(el, attrs) {
  for(var key in attrs) {el.setAttribute(key, attrs[key]);}
}
function setProperties(el, props) {
  for(var key in props) {el[key] = props[key];}
}
function addElement(parent, elementTag, attrs, props, NS) {
    // Adds an element to the parent object in the document, adds
    // the given attributes and properties and returns the object
    // NS is an optional namespace for the new element.
    // If omitted, it will default to the namespace of the doc
    if (typeof NS === "undefined") NS = parent.namespaceURI;
    var newElement = parent.ownerDocument.createElementNS(NS, elementTag);
    if (attrs && typeof attrs === 'object' && attrs.constructor === Object) setAttributes(newElement, attrs);
    if (props && typeof props === 'object' && props.constructor === Object) setProperties(newElement, props);
    parent.appendChild(newElement);
    return newElement
}
function removeElement(element) {
    // Removes an element from the document
    element.parentNode.removeChild(element);
}

function Draw(obj){
  obj.units = " KW";
  obj.startLabel = "Random Data";
  obj.startTitle = "Loading...";
  obj.title = "Random Elec"
  obj.starthue = 120;  // Green at 0%
  obj.endhue = 0; // Red at 100%
  obj.sat = 100;  // Saturation
  obj.lum = 50;   // Luminance
  obj.svg = addElement(obj.div, "svg", {"viewBox":"0 0 205 105","preserveAspectRatio":"xMidYMid meet"}, null, "http://www.w3.org/2000/svg");
  
  var h = obj.svg.viewBox.baseVal.height-5;
  var w = obj.svg.viewBox.baseVal.width-5;
  var s =  w/10;
  var strokecolour = "hsla("+obj.starthue+","+obj.sat+"%,"+obj.lum+"%,1)";    // Line Colour at 0%
  var facecolour = "hsla("+obj.starthue+","+obj.sat+"%,"+obj.lum+"%,0.25)";   // Face Colour at 0%
  var arcd = ["M",s/2,h,"a",(w/2)-s,h-s,0,0,1,w-s,0];
  
  var defs = addElement(obj.svg, "defs");
  var filter = addElement(defs, "filter", {"id":"shadow", "x":"-20%", "y":"-20%", "width":"140%", "height":"140%"});
  var feOffset = addElement(filter, "feOffset", {"dx":"5", "dy":"5", "in":"SourceGraphic", "result":"offOut"});
  var feColorMatrix = addElement(filter, "feColorMatrix", {"result":"matrixOut", "in":"offOut", "type":"matrix", "values":"0.1 0 0 0 0  0 0.1 0 0 0  0 0 0.1 0 0  0 0 0 0.75 0"});
  var feGaussianBlur = addElement(filter, "feGaussianBlur", {"stdDeviation":"2", "in":"matrixOut", "result":"blurOut"});
  var feBlend = addElement(filter, "feBlend", {"in":"SourceGraphic", "in2":"blurOut", "mode":"normal"});
  
  obj.gaugeFace = addElement(obj.svg, "path", {"id":"gaugeFace", "filter":"url(#shadow)", "d":arcd.join(" ")});
  var totlen = obj.gaugeFace.getTotalLength();
  setProperties(obj.gaugeFace.style,{
    "fill": "hsla("+obj.starthue+","+obj.sat+"%,"+obj.lum+"%,0)",// Fade in from nothing, alpha=0
    "stroke": "hsla("+obj.starthue+","+obj.sat+"%,"+obj.lum+"%,0)",// Fade in from nothing, alpha=0
    "stroke-width": s,
    "stroke-dasharray": totlen,
    "stroke-dashoffset": totlen,
  });
  
  var animAttr = {"attributeType":"XML", "dur":"1s", "fill":"freeze", "calcMode":"spline", "keyTimes":"0;1", "keySplines":"0.5 0 0.5 1"};
  obj.lineLengthAnim = addElement(obj.gaugeFace, "animate", extend({"id":"lineLengthAnim", "attributeName":"stroke-dashoffset", "from": totlen, "to": totlen},animAttr))
  obj.lineColourAnim = addElement(obj.gaugeFace, "animate", extend({"id":"lineColourAnim", "attributeName":"stroke", "begin":"lineLengthAnim.begin", "from": obj.gaugeFace.style.stroke, "to": strokecolour},animAttr))
  obj.faceColourAnim = addElement(obj.gaugeFace, "animate", extend({"id":"faceColourAnim", "attributeName":"fill", "begin":"lineLengthAnim.begin", "from": obj.gaugeFace.style.fill, "to": facecolour},animAttr))
  
  var title = addElement(obj.svg, "text", {"id":"title", "filter":"url(#shadow)", "opacity":0, "text-anchor":"middle", "x":"100", "y":"95", "fill":"black", "font-family":"Lato,'Lucida Console', Monaco, monospace", "font-size":"16px"});
  //title.textContent = obj.startTitle;
  var titleAnim = addElement(title, "animate", extend({"id":"titleAnim", "attributeName":"opacity", "begin":"lineLengthAnim.begin", "from": 0, "to": 1},animAttr))
  title.appendChild(document.createTextNode(obj.startTitle))
  titleAnim.onend = function() {
    title.setAttribute("opacity",1);  // Keep it permanent
    this.parentNode.removeChild(this);
    title.textContent = obj.title;
  }
  
  obj.label = addElement(obj.svg, "text", {"id":"label", "filter":"url(#shadow)", "opacity":0, "text-anchor":"middle", "x":"100", "y":"66", "fill":"black", "font-family":"Lato,'Lucida Console', Monaco, monospace", "font-size":"20px"});
  //obj.label.textContent = obj.startLabel;
  var labelAnim = addElement(obj.label, "animate", extend({"id":"labelAnim", "attributeName":"opacity", "begin":"lineLengthAnim.begin", "from": 0, "to": 1},animAttr))
  obj.label.appendChild(document.createTextNode(obj.startLabel))
  labelAnim.onend = function () {
    obj.label.setAttribute("opacity",1);  // Keep it permanent
    this.parentNode.removeChild(this);
    obj.label.textContent = "-.--"+obj.units;
  }
  obj.lineLengthAnim.onend = () => Update(obj,Math.random()*50.0,50.0);
  obj.lineLengthAnim.beginElement();
}

function Update(obj,rawval,max) {
  rawval = parseFloat(rawval);
  var percent = rawval / max;
  // Keep the percentages within limits
  if (percent < 0) percent = 0;
  else if (percent > 100) percent = 100;
  var offset = obj.gaugeFace.getTotalLength() * (1-percent);
  var newhue = obj.starthue - (obj.starthue-obj.endhue) * percent;
  setAttributes(obj.lineLengthAnim,{
    "from": obj.lineLengthAnim.getAttribute("to"),
    "to": offset,
  });
  setAttributes(obj.lineColourAnim,{
    "from": obj.lineColourAnim.getAttribute("to"),
    "to": "hsla("+newhue+","+obj.sat+"%,"+obj.lum+"%,1)",
  });
  setAttributes(obj.faceColourAnim,{
    "from": obj.faceColourAnim.getAttribute("to"),
    "to": "hsla("+newhue+","+obj.sat+"%,"+obj.lum+"%,0.25)",
  });
  obj.label.textContent = rawval.toFixed(2)+obj.units
  obj.lineLengthAnim.beginElement();
}

const Gauge1 = {"div":document.getElementById("Gauge1")};
Draw(Gauge1);
</script>

</body>
</html>




